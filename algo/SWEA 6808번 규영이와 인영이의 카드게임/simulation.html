<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>순열 계산 방식 비교 시뮬레이션</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI','Malgun Gothic',sans-serif;background:#f4f6f8;color:#333}
header{background:linear-gradient(135deg,#1a237e,#283593);color:#fff;text-align:center;padding:24px 16px}
header h1{font-size:22px;margin-bottom:4px}
header p{font-size:14px;opacity:.8}
.info-bar{display:flex;justify-content:center;gap:40px;padding:12px;background:#fff;border-bottom:1px solid #ddd;font-size:14px;flex-wrap:wrap}
.info-bar .gyu{color:#1565c0;font-weight:bold}
.info-bar .in{color:#e65100;font-weight:bold}
.main{display:flex;gap:16px;padding:16px;max-width:1200px;margin:0 auto;flex-wrap:wrap}
.panel{flex:1;min-width:400px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column}
.panel-hd{padding:14px;text-align:center}
.panel-hd h3{font-size:16px;margin-bottom:2px}
.panel-hd p{font-size:12px;opacity:.7}
#p1 .panel-hd{background:#e8eaf6;color:#283593}
#p2 .panel-hd{background:#e0f2f1;color:#00695c}
.status{text-align:center;padding:8px;font-size:13px;min-height:36px;background:#fafafa;border-bottom:1px solid #eee}
.rounds{display:flex;justify-content:center;gap:12px;padding:16px;flex-wrap:wrap}
.rslot{display:flex;flex-direction:column;align-items:center;gap:4px;position:relative}
.rslot .rlabel{font-size:11px;color:#888;font-weight:600}
.card{width:52px;height:68px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:bold;border:2.5px solid;transition:all .15s}
.card-g{border-color:#1565c0;color:#1565c0;background:#e3f2fd}
.card-i{border-color:#e65100;color:#e65100;background:#fff3e0}
.card-empty{border:2.5px dashed #ccc;color:#ccc;background:#fafafa}
.vs{font-size:11px;color:#999;font-weight:bold}
.score-area{display:flex;justify-content:center;gap:24px;padding:8px;font-size:14px}
.score-area .sg{color:#1565c0;font-weight:bold}
.score-area .si{color:#e65100;font-weight:bold}
.counter-area{text-align:center;padding:12px}
.counter-area .clabel{font-size:12px;color:#888;margin-bottom:4px}
.counter-area .cnum{font-size:48px;font-weight:800;transition:all .15s}
#p1 .cnum{color:#3949ab}
#p2 .cnum{color:#00897b}
.result-area{display:flex;justify-content:center;gap:20px;padding:10px;font-size:14px;border-top:1px solid #eee}
.result-area .w{color:#2e7d32;font-weight:bold}
.result-area .l{color:#c62828;font-weight:bold}
.result-area .perm{color:#888}
.controls{display:flex;justify-content:center;align-items:center;gap:10px;padding:14px;flex-wrap:wrap;max-width:1200px;margin:0 auto}
.controls button{padding:8px 18px;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:background .15s}
.btn-play{background:#2e7d32;color:#fff}
.btn-play:hover{background:#1b5e20}
.btn-pause{background:#f57f17;color:#fff}
.btn-pause:hover{background:#e65100}
.btn-step{background:#1565c0;color:#fff}
.btn-step:hover{background:#0d47a1}
.btn-reset{background:#757575;color:#fff}
.btn-reset:hover{background:#424242}
.controls label{font-size:13px;color:#666}
.controls input[type=range]{width:100px}
.controls .spd-label{font-size:12px;color:#888;min-width:40px}
.comp{max-width:1200px;margin:8px auto;padding:0 16px}
.comp-inner{background:#fff;border-radius:10px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.comp h4{font-size:14px;text-align:center;margin-bottom:12px;color:#555}
.bar-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;font-size:13px}
.bar-row .bar-label{width:120px;text-align:right;font-weight:600}
.bar-row .bar-track{flex:1;height:28px;background:#f0f0f0;border-radius:6px;overflow:hidden;position:relative}
.bar-row .bar-fill{height:100%;border-radius:6px;transition:width .2s;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;font-size:12px;font-weight:bold;color:#fff;min-width:0}
#bar1 .bar-fill{background:linear-gradient(90deg,#5c6bc0,#3949ab)}
#bar2 .bar-fill{background:linear-gradient(90deg,#4db6ac,#00897b)}
.bar-row .bar-num{width:50px;font-weight:bold;font-size:14px}
.summary{max-width:1200px;margin:12px auto;padding:0 16px 24px}
.summary-inner{background:#fff;border-radius:10px;padding:20px;box-shadow:0 1px 4px rgba(0,0,0,.06);display:none}
.summary-inner h4{text-align:center;margin-bottom:16px;font-size:16px;color:#333}
.sum-table{width:100%;border-collapse:collapse;font-size:14px;margin-bottom:16px}
.sum-table th,.sum-table td{padding:10px 12px;border:1px solid #e0e0e0;text-align:center}
.sum-table th{background:#f5f5f5;font-weight:600}
.sum-table .highlight{background:#fff8e1;font-weight:bold}
.insight{background:#e8f5e9;border-radius:8px;padding:14px;font-size:13px;line-height:1.7;color:#1b5e20}
.insight strong{color:#00695c}
@keyframes calcPulse{
  0%{box-shadow:0 0 0 rgba(249,168,37,0);transform:scale(1)}
  50%{box-shadow:0 0 18px rgba(249,168,37,.7);transform:scale(1.08)}
  100%{box-shadow:0 0 0 rgba(249,168,37,0);transform:scale(1)}
}
.card.flash-calc{animation:calcPulse .3s;border-color:#f9a825!important;background:#fff8e1!important;color:#f57f17!important}
@keyframes resultFlash{
  0%{opacity:1}50%{opacity:.5}100%{opacity:1}
}
.panel.flash-win{animation:resultFlash .3s;box-shadow:0 0 12px rgba(46,125,50,.4)!important}
.panel.flash-lose{animation:resultFlash .3s;box-shadow:0 0 12px rgba(198,40,40,.4)!important}
.progress{max-width:1200px;margin:0 auto;padding:4px 16px}
.progress-bar{height:4px;background:#e0e0e0;border-radius:2px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#3949ab,#00897b);transition:width .1s;width:0}
.code-section{max-width:1200px;margin:8px auto;padding:0 16px}
.code-inner{background:#fff;border-radius:10px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.code-inner h4{text-align:center;margin-bottom:12px;font-size:14px;color:#555;cursor:pointer}
.code-compare{display:flex;gap:16px;flex-wrap:wrap}
.code-box{flex:1;min-width:300px;background:#263238;color:#eee;border-radius:8px;padding:12px;font-family:'Consolas','Courier New',monospace;font-size:12px;line-height:1.6;white-space:pre;overflow-x:auto}
.code-box .cm{color:#78909c}
.code-box .kw{color:#82b1ff}
.code-box .hl{background:rgba(249,168,37,.25);display:inline}
</style>
</head>
<body>
<header>
  <h1>SWEA 6808: 규영이와 인영이의 카드게임</h1>
  <p>순열 계산 방식 비교 시뮬레이션 (4장 축소 버전)</p>
</header>
<div class="info-bar">
  <div>규영이 카드 (라운드순): <span class="gyu" id="gyuInfo"></span></div>
  <div>인영이 카드: <span class="in" id="inInfo"></span></div>
  <div>총 순열 수: <span id="totalPerm"></span></div>
</div>
<div class="progress"><div class="progress-bar"><div class="progress-fill" id="progFill"></div></div></div>
<div class="main">
  <div class="panel" id="p1">
    <div class="panel-hd"><h3>방법 1: 순열 완성 후 계산</h3><p>calcTotal()에서 for문으로 전체 라운드 재계산</p></div>
    <div class="status" id="st1">대기 중</div>
    <div class="rounds" id="rounds1"></div>
    <div class="score-area"><span class="sg">규영: <span id="s1g">-</span></span><span class="si">인영: <span id="s1i">-</span></span></div>
    <div class="counter-area"><div class="clabel">연산 횟수</div><div class="cnum" id="c1">0</div></div>
    <div class="result-area"><span class="w">승: <span id="w1">0</span></span><span class="l">패: <span id="l1">0</span></span><span class="perm">순열: <span id="pm1">0</span>/<span id="pmT1"></span></span></div>
  </div>
  <div class="panel" id="p2">
    <div class="panel-hd"><h3>방법 2: 과정 중 계산</h3><p>매개변수로 누적 점수 전달 (매 라운드 즉시 계산)</p></div>
    <div class="status" id="st2">대기 중</div>
    <div class="rounds" id="rounds2"></div>
    <div class="score-area"><span class="sg">규영: <span id="s2g">0</span></span><span class="si">인영: <span id="s2i">0</span></span></div>
    <div class="counter-area"><div class="clabel">연산 횟수</div><div class="cnum" id="c2">0</div></div>
    <div class="result-area"><span class="w">승: <span id="w2">0</span></span><span class="l">패: <span id="l2">0</span></span><span class="perm">순열: <span id="pm2">0</span>/<span id="pmT2"></span></span></div>
  </div>
</div>
<div class="controls">
  <button class="btn-play" id="btnPlay" onclick="play()">&#9654; 시작</button>
  <button class="btn-pause" id="btnPause" onclick="pause()">&#10074;&#10074; 일시정지</button>
  <button class="btn-step" onclick="step()">&#9654;&#10074; 한 단계</button>
  <button class="btn-reset" onclick="doReset()">&#8634; 리셋</button>
  <label>속도:</label>
  <input type="range" id="spdSlider" min="1" max="6" value="3" oninput="updateSpeed()">
  <span class="spd-label" id="spdLabel">보통</span>
</div>
<div class="comp"><div class="comp-inner">
  <h4>연산 횟수 실시간 비교</h4>
  <div class="bar-row" id="bar1"><span class="bar-label" style="color:#3949ab">방법 1</span><div class="bar-track"><div class="bar-fill"></div></div><span class="bar-num">0</span></div>
  <div class="bar-row" id="bar2"><span class="bar-label" style="color:#00897b">방법 2</span><div class="bar-track"><div class="bar-fill"></div></div><span class="bar-num">0</span></div>
</div></div>
<div class="code-section"><div class="code-inner">
  <h4 onclick="document.getElementById('codeArea').style.display=document.getElementById('codeArea').style.display==='none'?'flex':'none'">&#9660; 핵심 코드 비교 (클릭하여 열기/닫기)</h4>
  <div class="code-compare" id="codeArea" style="display:none">
    <div class="code-box"><span class="cm">// 방법 1: 기저조건에서 전체 재계산</span>
<span class="kw">if</span>(cnt==9) {
    <span class="hl">calcTotal();</span> <span class="cm">// 9라운드 for문</span>
    <span class="kw">return</span>;
}
<span class="kw">for</span>(<span class="kw">int</span> i=0; i&lt;9; i++) {
    ...
    roundIn[cnt] = in[i];
    permutation(cnt+1);     <span class="cm">// 점수 전달 X</span>
    ...
}

<span class="cm">// calcTotal 메서드</span>
<span class="kw">for</span>(<span class="kw">int</span> i=0; i&lt;9; i++) {  <span class="cm">// ← 매번 9회 반복!</span>
    <span class="kw">if</span>(roundGyu[i] > roundIn[i])
        <span class="hl">sumGyu += roundGyu[i]+roundIn[i];</span>
    <span class="kw">else</span>
        <span class="hl">sumIn += roundGyu[i]+roundIn[i];</span>
}</div>
    <div class="code-box"><span class="cm">// 방법 2: 매개변수로 누적 전달</span>
<span class="kw">if</span>(cnt==9) {
    <span class="cm">// 이미 계산 완료, 비교만!</span>
    <span class="kw">if</span>(sumGyu > sumIn) win++;
    <span class="kw">return</span>;
}
<span class="kw">for</span>(<span class="kw">int</span> i=0; i&lt;9; i++) {
    ...
    <span class="kw">if</span>(roundGyu[cnt] > in[i])
        permutation(cnt+1,
          <span class="hl">sumGyu+roundGyu[cnt]+in[i]</span>, sumIn);
    <span class="kw">else</span>
        permutation(cnt+1,
          sumGyu, <span class="hl">sumIn+roundGyu[cnt]+in[i]</span>);
    ...
}
<span class="cm">// 별도 calcTotal 메서드 불필요!</span></div>
  </div>
</div></div>
<div class="summary"><div class="summary-inner" id="sumSection">
  <h4>시뮬레이션 결과 요약</h4>
  <table class="sum-table">
    <tr><th></th><th style="color:#3949ab">방법 1 (완성 후 계산)</th><th style="color:#00897b">방법 2 (과정 중 계산)</th></tr>
    <tr><td>4장 연산 횟수</td><td id="fin1">-</td><td id="fin2">-</td></tr>
    <tr><td>9장 연산 횟수 (실제)</td><td class="highlight">3,265,920</td><td class="highlight">623,529</td></tr>
    <tr><td>9장 실행 시간</td><td>2,105 ms</td><td>1,508 ms</td></tr>
    <tr><td>절감률 (9장 기준)</td><td colspan="2" class="highlight" id="finRatio">연산 80.9% 감소 / 시간 28.4% 감소</td></tr>
  </table>
  <div class="insight">
    <strong>핵심 차이:</strong> 방법 1은 순열이 완성될 때마다(9! = 362,880번) 매번 9개 라운드를 <strong>처음부터 다시</strong> 계산합니다.<br>
    방법 2는 카드를 선택하는 <strong>그 순간에 해당 라운드만</strong> 계산하고, 누적 점수를 매개변수로 넘깁니다.<br>
    같은 라운드를 중복 계산하지 않으므로 연산 횟수가 <strong>약 5.2배 적습니다.</strong><br><br>
    <strong>비유:</strong> 시험 채점 시, 방법 1은 답안지가 완성될 때마다 1번 문제부터 다시 채점하는 것이고,<br>
    방법 2는 학생이 한 문제를 풀 때마다 바로 채점하고 점수를 기록해두는 것입니다.
  </div>
</div></div>

<script>
const GYU = [3, 7, 2, 8];
const IN = [1, 4, 5, 6];
const N = GYU.length;
const TOTAL_PERM = factorial(N);

function factorial(n) { let r = 1; for (let i = 2; i <= n; i++) r *= i; return r; }

// ===== Event generation =====
function generateEvents() {
  const events = [];
  const used = Array(N).fill(false);
  const perm = Array(N).fill(null);
  function dfs(d) {
    if (d === N) {
      for (let r = 0; r < N; r++)
        events.push({ t: 'LC', r, g: GYU[r], c: perm[r] });
      events.push({ t: 'RES' });
      return;
    }
    for (let i = 0; i < N; i++) {
      if (used[i]) continue;
      used[i] = true;
      perm[d] = IN[i];
      events.push({ t: 'EN', r: d, c: IN[i], g: GYU[d] });
      dfs(d + 1);
      events.push({ t: 'EX', r: d, c: IN[i], g: GYU[d] });
      used[i] = false;
      perm[d] = null;
    }
  }
  dfs(0);
  return events;
}

const allEvents = generateEvents();

// ===== State =====
let S = {};
function resetState() {
  S = {
    cards: Array(N).fill(null),
    c1_calc: 0, c1_sumG: 0, c1_sumI: 0, c1_win: 0, c1_lose: 0, c1_perm: 0, c1_leafStart: false,
    c2_calc: 0, c2_sumG: 0, c2_sumI: 0, c2_win: 0, c2_lose: 0, c2_perm: 0,
    idx: 0, playing: false, timer: null, done: false
  };
}
resetState();

// ===== Speed =====
const SPEEDS = [800, 400, 200, 80, 30, 5];
const SPEED_NAMES = ['매우 느림', '느림', '보통', '빠름', '매우 빠름', '최고속'];
let speed = SPEEDS[2];

function updateSpeed() {
  const v = document.getElementById('spdSlider').value - 1;
  speed = SPEEDS[v];
  document.getElementById('spdLabel').textContent = SPEED_NAMES[v];
  if (S.playing) { clearInterval(S.timer); S.timer = setInterval(step, speed); }
}

// ===== Build round slots =====
function buildRounds() {
  for (let p = 1; p <= 2; p++) {
    const container = document.getElementById('rounds' + p);
    container.innerHTML = '';
    for (let r = 0; r < N; r++) {
      const slot = document.createElement('div');
      slot.className = 'rslot';
      slot.innerHTML = `
        <div class="rlabel">R${r + 1}</div>
        <div class="card card-g">${GYU[r]}</div>
        <div class="vs">VS</div>
        <div class="card card-empty" id="ci${p}_${r}">?</div>`;
      container.appendChild(slot);
    }
  }
}

// ===== Render =====
function render(evt) {
  // Cards
  for (let r = 0; r < N; r++) {
    for (let p = 1; p <= 2; p++) {
      const el = document.getElementById(`ci${p}_${r}`);
      if (S.cards[r] !== null) {
        el.textContent = S.cards[r];
        el.className = 'card card-i';
      } else {
        el.textContent = '?';
        el.className = 'card card-empty';
      }
    }
  }

  // Scores
  document.getElementById('s1g').textContent = S.c1_leafStart ? S.c1_sumG : '-';
  document.getElementById('s1i').textContent = S.c1_leafStart ? S.c1_sumI : '-';
  document.getElementById('s2g').textContent = S.c2_sumG;
  document.getElementById('s2i').textContent = S.c2_sumI;

  // Counters
  document.getElementById('c1').textContent = S.c1_calc;
  document.getElementById('c2').textContent = S.c2_calc;

  // Win/Lose/Perm
  document.getElementById('w1').textContent = S.c1_win;
  document.getElementById('l1').textContent = S.c1_lose;
  document.getElementById('pm1').textContent = S.c1_perm;
  document.getElementById('w2').textContent = S.c2_win;
  document.getElementById('l2').textContent = S.c2_lose;
  document.getElementById('pm2').textContent = S.c2_perm;

  // Progress
  document.getElementById('progFill').style.width = (S.idx / allEvents.length * 100) + '%';

  // Comparison bars
  const mx = Math.max(S.c1_calc, S.c2_calc, 1);
  document.querySelector('#bar1 .bar-fill').style.width = (S.c1_calc / mx * 100) + '%';
  document.querySelector('#bar1 .bar-fill').textContent = S.c1_calc > 0 ? S.c1_calc : '';
  document.querySelector('#bar1 .bar-num').textContent = S.c1_calc;
  document.querySelector('#bar2 .bar-fill').style.width = (S.c2_calc / mx * 100) + '%';
  document.querySelector('#bar2 .bar-fill').textContent = S.c2_calc > 0 ? S.c2_calc : '';
  document.querySelector('#bar2 .bar-num').textContent = S.c2_calc;

  // Animations
  if (evt) {
    if (evt.t === 'EN') {
      flashCard(2, evt.r);
      setStatus(1, `라운드 ${evt.r+1}에 카드 ${evt.c} 배치`);
      setStatus(2, `라운드 ${evt.r+1}에 카드 ${evt.c} 배치 + 즉시 점수 계산`);
    } else if (evt.t === 'LC') {
      flashCard(1, evt.r);
      setStatus(1, `calcTotal(): 라운드 ${evt.r+1} 계산 중... (+${evt.g}+${evt.c}=${evt.g+evt.c})`);
      setStatus(2, `대기 중 (이미 계산 완료)`);
    } else if (evt.t === 'RES') {
      const w = S.c1_sumG > S.c1_sumI;
      const txt = w ? '규영 승리!' : (S.c1_sumG < S.c1_sumI ? '인영 승리!' : '무승부');
      setStatus(1, `결과: ${txt} (${S.c1_sumG} vs ${S.c1_sumI})`);
      setStatus(2, `결과: ${txt} (${S.c2_sumG} vs ${S.c2_sumI})`);
      flashPanel(w);
    } else if (evt.t === 'EX') {
      setStatus(1, `라운드 ${evt.r+1} 되돌리기 (백트래킹)`);
      setStatus(2, `라운드 ${evt.r+1} 되돌리기 + 점수 복원`);
    }
  }
}

function flashCard(panel, round) {
  const el = document.getElementById(`ci${panel}_${round}`);
  el.classList.remove('flash-calc');
  void el.offsetWidth;
  el.classList.add('flash-calc');
  setTimeout(() => el.classList.remove('flash-calc'), 300);
}

function flashPanel(win) {
  const cls = win ? 'flash-win' : 'flash-lose';
  for (let p of [document.getElementById('p1'), document.getElementById('p2')]) {
    p.classList.remove('flash-win', 'flash-lose');
    void p.offsetWidth;
    p.classList.add(cls);
    setTimeout(() => p.classList.remove(cls), 300);
  }
}

function setStatus(panel, text) {
  document.getElementById('st' + panel).textContent = text;
}

// ===== Process event =====
function processEvent() {
  if (S.idx >= allEvents.length) {
    pause();
    S.done = true;
    showSummary();
    return false;
  }
  const evt = allEvents[S.idx];
  switch (evt.t) {
    case 'EN':
      S.cards[evt.r] = evt.c;
      if (evt.g > evt.c) S.c2_sumG += evt.g + evt.c;
      else S.c2_sumI += evt.g + evt.c;
      S.c2_calc++;
      break;
    case 'LC':
      if (!S.c1_leafStart) { S.c1_sumG = 0; S.c1_sumI = 0; S.c1_leafStart = true; }
      if (evt.g > evt.c) S.c1_sumG += evt.g + evt.c;
      else S.c1_sumI += evt.g + evt.c;
      S.c1_calc++;
      break;
    case 'RES':
      if (S.c1_sumG > S.c1_sumI) S.c1_win++; else if (S.c1_sumG < S.c1_sumI) S.c1_lose++;
      if (S.c2_sumG > S.c2_sumI) S.c2_win++; else if (S.c2_sumG < S.c2_sumI) S.c2_lose++;
      S.c1_perm++; S.c2_perm++;
      S.c1_leafStart = false;
      break;
    case 'EX':
      S.cards[evt.r] = null;
      S.c1_leafStart = false;
      if (evt.g > evt.c) S.c2_sumG -= evt.g + evt.c;
      else S.c2_sumI -= evt.g + evt.c;
      break;
  }
  S.idx++;
  render(evt);
  return true;
}

// ===== Playback controls =====
function play() {
  if (S.done) return;
  S.playing = true;
  document.getElementById('btnPlay').disabled = true;
  S.timer = setInterval(() => {
    if (!processEvent()) pause();
  }, speed);
}

function pause() {
  S.playing = false;
  document.getElementById('btnPlay').disabled = false;
  if (S.timer) { clearInterval(S.timer); S.timer = null; }
}

function step() {
  if (S.done) return;
  if (S.playing) pause();
  processEvent();
}

function doReset() {
  pause();
  resetState();
  buildRounds();
  render(null);
  setStatus(1, '대기 중');
  setStatus(2, '대기 중');
  document.getElementById('sumSection').style.display = 'none';
  document.getElementById('btnPlay').disabled = false;
}

function showSummary() {
  document.getElementById('fin1').textContent = S.c1_calc;
  document.getElementById('fin2').textContent = S.c2_calc;
  document.getElementById('sumSection').style.display = 'block';
  setStatus(1, `완료! 총 연산: ${S.c1_calc}회`);
  setStatus(2, `완료! 총 연산: ${S.c2_calc}회`);
}

// ===== Init =====
function init() {
  document.getElementById('gyuInfo').textContent = GYU.join(', ');
  document.getElementById('inInfo').textContent = IN.join(', ');
  document.getElementById('totalPerm').textContent = TOTAL_PERM;
  document.getElementById('pmT1').textContent = TOTAL_PERM;
  document.getElementById('pmT2').textContent = TOTAL_PERM;
  buildRounds();
  render(null);
}
init();
</script>
</body>
</html>
