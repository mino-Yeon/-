<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SWEA 1952: 수영장 - 상태공간 트리</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Malgun Gothic','Apple SD Gothic Neo',sans-serif;background:#f0f2f5;color:#333;height:100vh;display:flex;flex-direction:column;}
.header{background:#1a237e;color:#fff;padding:12px 24px;display:flex;align-items:center;gap:16px;}
.header h1{font-size:18px;} .header .sub{font-size:13px;color:#94a3b8;}
.controls{background:#283593;padding:10px 24px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.min-disp{display:inline-flex;align-items:center;gap:6px;background:#1e293b;color:#fbbf24;padding:6px 16px;border-radius:6px;font-family:'Consolas','D2Coding',monospace;font-size:20px;font-weight:700;border:2px solid #fbbf24;text-shadow:0 0 8px rgba(251,191,36,.4);}
.min-disp .ml{color:#94a3b8;font-weight:600;font-size:14px;}
.summary-disp{color:#cbd5e1;font-size:13px;font-family:'Consolas','D2Coding',monospace;}
.min-overlay{position:absolute;top:30px;left:16px;z-index:10;display:inline-flex;align-items:center;gap:6px;background:rgba(30,41,59,.92);color:#fbbf24;padding:8px 18px;border-radius:8px;font-family:'Consolas','D2Coding',monospace;font-size:22px;font-weight:700;border:2px solid #fbbf24;box-shadow:0 2px 12px rgba(0,0,0,.3);pointer-events:none;}
.min-overlay .ml{color:#94a3b8;font-weight:600;font-size:14px;}
.min-overlay .min-hist{font-size:13px;color:#94a3b8;font-weight:400;margin-left:8px;}
.main{display:flex;flex:1;overflow:hidden;}
.code-panel{width:24%;min-width:280px;background:#1e1e1e;display:flex;flex-direction:column;transition:width .3s,min-width .3s;}
.code-panel.collapsed{width:40px;min-width:40px;}
.code-panel.collapsed .code-body{display:none;}
.code-panel.collapsed .panel-hd span{display:none;}
.panel-hd{background:#2d2d2d;color:#94a3b8;padding:8px 16px;font-size:12px;font-weight:600;border-bottom:1px solid #3d3d3d;cursor:pointer;user-select:none;display:flex;align-items:center;gap:8px;}
.panel-hd:hover{background:#3d3d3d;}
.panel-hd::before{content:'◀';font-size:10px;transition:transform .3s;}
.code-panel.collapsed .panel-hd::before{transform:rotate(180deg);}
.code-body{flex:1;overflow-y:auto;padding:8px 0;}
.cl{display:flex;padding:1px 0;font-family:'Consolas','D2Coding',monospace;font-size:13px;line-height:1.6;}
.ln{width:36px;text-align:right;padding-right:10px;color:#555;user-select:none;flex-shrink:0;}
.lc{color:#d4d4d4;white-space:pre;}
.kw{color:#569cd6;}.tp{color:#4ec9b0;}.nm{color:#b5cea8;}.st{color:#ce9178;}.cm{color:#6a9955;}.fn{color:#dcdcaa;}
.resizer{width:6px;background:#283593;cursor:col-resize;transition:background .15s;flex-shrink:0;}
.resizer:hover,.resizer.dragging{background:#3498db;}
body.resizing{cursor:col-resize;user-select:none;}
body.resizing *{pointer-events:none;}
body.resizing .resizer{pointer-events:auto;}
.viz-panel{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.vs{border-bottom:1px solid #ddd;}
.vs .sh{background:#e8ecf0;padding:5px 16px;font-size:12px;font-weight:600;color:#64748b;}
.vs .sb{padding:10px 16px;background:#fff;}
.plan-tbl{border-collapse:collapse;font-size:12px;font-family:'Consolas','D2Coding',monospace;margin-bottom:8px;}
.plan-tbl th,.plan-tbl td{padding:3px 10px;text-align:center;border:1px solid #e2e8f0;}
.plan-tbl th{background:#f1f5f9;font-weight:600;color:#475569;}
.plan-tbl .better{background:#dcfce7;font-weight:700;color:#15803d;}
.plan-tbl .worse{color:#b0b0b0;}
.legend{display:flex;gap:14px;flex-wrap:wrap;align-items:center;font-size:11px;color:#64748b;}
.legend-item{display:flex;align-items:center;gap:3px;}
.lg-dot{width:12px;height:12px;border-radius:50%;border:2px solid;display:inline-block;}
.lg-line{width:18px;height:3px;border-radius:2px;display:inline-block;}
.tree-sec{flex:1;display:flex;flex-direction:column;min-height:0;position:relative;}
.tree-sec .sb{flex:1;overflow:auto;padding:8px;position:relative;background:#fafafa;}
.tree-node{transition:all .15s;cursor:pointer;}
.tree-node:hover{filter:brightness(1.1);stroke-width:3;}
.tn-unvisited{fill:#f0f0f0;stroke:#d1d5db;stroke-width:1.5;}
.tn-internal{fill:#bfdbfe;stroke:#3b82f6;stroke-width:2;}
.tn-completed{fill:#86efac;stroke:#22c55e;stroke-width:2;}
.tn-pruned{fill:#fecaca;stroke:#ef4444;stroke-width:2;stroke-dasharray:3,2;}
.tn-optimal{fill:#fde68a;stroke:#f59e0b;stroke-width:2.5;}
.te-unvisited{stroke:#e5e7eb;stroke-width:1;}
.te-day{stroke:#3b82f6;stroke-width:1.5;}
.te-month{stroke:#22c55e;stroke-width:1.5;}
.te-quarter{stroke:#f97316;stroke-width:2;stroke-dasharray:6,3;}
.te-dim{opacity:.2;}
.te-pruned-state{opacity:.4;}
.te-optimal{stroke-width:3!important;opacity:1!important;}
.te-highlight{stroke-width:3!important;opacity:1!important;filter:drop-shadow(0 0 2px rgba(0,0,0,.3));}
.node-lbl{font-size:22px;fill:#334155;font-family:'Consolas','D2Coding',monospace;font-weight:700;text-anchor:middle;dominant-baseline:central;pointer-events:none;}
.cost-lbl{font-size:16px;fill:#64748b;font-family:'Consolas','D2Coding',monospace;text-anchor:middle;pointer-events:none;}
.cost-lbl.cl-completed{fill:#15803d;font-weight:700;font-size:17px;}
.cost-lbl.cl-optimal{fill:#b45309;font-weight:700;font-size:18px;}
.edge-cost{font-size:16px;font-family:'Consolas','D2Coding',monospace;text-anchor:middle;pointer-events:none;fill:#6b7280;}
.tree-toggle{margin-left:auto;background:#64748b;color:#fff;border:none;padding:3px 10px;border-radius:4px;cursor:pointer;font-size:11px;}
.tree-toggle:hover{background:#475569;}
.viz-panel.tree-expanded .vs:not(.tree-sec){display:none;}
.viz-panel.tree-expanded .tree-sec{flex:1;}
</style>
</head>
<body>
<div class="header">
  <h1>SWEA 1952: 수영장 - 상태공간 트리</h1>
  <span class="sub">cost=[10, 30, 60, 200] &nbsp;|&nbsp; plan=[2, 8, 1, 6, 3] &nbsp;|&nbsp; 5개월 축소 버전</span>
</div>
<div class="controls">
  <div class="min-disp"><span class="ml">최적 비용 =</span><span id="minVal"></span></div>
  <span class="summary-disp" id="summaryDisp"></span>
</div>
<div class="main">
  <div class="code-panel" id="codePanel">
    <div class="panel-hd" onclick="toggleCode()"><span>Java Code (5개월 축소)</span></div>
    <div class="code-body" id="cb"></div>
  </div>
  <div class="resizer" id="resizer"></div>
  <div class="viz-panel" id="vizPanel">
    <div class="vs plan-sec"><div class="sh">이용 계획 & 범례</div><div class="sb"><div id="planArea"></div><div class="legend" id="lgd"></div></div></div>
    <div class="vs tree-sec">
      <div class="sh">상태공간 트리<span id="treeStat"></span><button class="tree-toggle" onclick="toggleTreeExpand()">⤢ 최대화</button></div>
      <div class="sb" id="tc"></div>
      <div class="min-overlay" id="minOv"><span class="ml">최솟값</span> <span id="minVal2"></span><span class="min-hist" id="minHist2"></span></div>
    </div>
  </div>
</div>
<script>
// ===== Constants =====
const COST=[10,30,60,200], PLAN=[0,2,8,1,6,3], M=5;
const TK_NAME=['하루권','한달권','세달권'], TK_KEY=['day','month','quarter'];
const TK_COLOR=['#3b82f6','#22c55e','#f97316'];

// ===== Java Source =====
const SRC=[
'static int[] cost = {10, 30, 60, 200};',
'static int[] plan = {0, 2, 8, 1, 6, 3};',
'static int min;',
'',
'public static void main(String[] args) {',
'    min = cost[3];  // 1년권(200)으로 초기화',
'    selectTicket(1, 0);',
'    System.out.println(min);',
'}',
'',
'static void selectTicket(int month, int costSum) {',
'    if(min <= costSum) return;   // 가지치기',
'    if(month > 5) {',
'        min = costSum;           // 최솟값 갱신',
'        return;',
'    }',
'    // 하루권',
'    selectTicket(month+1, costSum + plan[month]*cost[0]);',
'    // 한달권',
'    selectTicket(month+1, costSum + cost[1]);',
'    // 세달권',
'    selectTicket(month+3, costSum + cost[2]);',
'}'
];

// ===== Syntax Highlighter =====
function hl(t){
  t=t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  let cm='';t=t.replace(/(\/\/.*)$/gm,function(m){cm=m;return '\x00CM';});
  let ss=[];t=t.replace(/"([^"]*)"/g,function(m){ss.push(m);return '\x00S'+(ss.length-1);});
  t=t.replace(/\b(static|void|int|if|return|public)\b/g,'<span class="kw">$1</span>');
  t=t.replace(/\b(String|System)\b/g,'<span class="tp">$1</span>');
  t=t.replace(/\b(\d+)\b/g,'<span class="nm">$1</span>');
  ss.forEach((s,i)=>{t=t.replace('\x00S'+i,'<span class="st">'+s+'</span>');});
  if(cm)t=t.replace('\x00CM','<span class="cm">'+cm+'</span>');
  return t;
}
function initCode(){
  document.getElementById('cb').innerHTML=SRC.map((l,i)=>
    `<div class="cl" id="L${i}"><span class="ln">${i+1}</span><span class="lc">${hl(l)}</span></div>`).join('');
}

// ===== Plan Table & Legend =====
function initPlan(){
  let h='<table class="plan-tbl"><tr><th></th>';
  for(let m=1;m<=M;m++) h+=`<th>${m}월</th>`;
  h+='</tr><tr><th>이용일</th>';
  for(let m=1;m<=M;m++) h+=`<td>${PLAN[m]}일</td>`;
  h+='</tr><tr><th>하루권</th>';
  for(let m=1;m<=M;m++){
    const dc=PLAN[m]*COST[0], cls=dc<=COST[1]?'better':'worse';
    h+=`<td class="${cls}">${dc}원</td>`;
  }
  h+='</tr><tr><th>한달권</th>';
  for(let m=1;m<=M;m++){
    const dc=PLAN[m]*COST[0], cls=COST[1]<=dc?'better':'worse';
    h+=`<td class="${cls}">${COST[1]}원</td>`;
  }
  h+='</tr></table>';
  document.getElementById('planArea').innerHTML=h;

  let lg='';
  lg+=`<span class="legend-item"><span class="lg-dot" style="background:#bfdbfe;border-color:#3b82f6"></span>내부노드</span>`;
  lg+=`<span class="legend-item"><span class="lg-dot" style="background:#86efac;border-color:#22c55e"></span>완료(min갱신)</span>`;
  lg+=`<span class="legend-item"><span class="lg-dot" style="background:#fecaca;border-color:#ef4444;border-style:dashed"></span>가지치기</span>`;
  lg+=`<span class="legend-item"><span class="lg-dot" style="background:#fde68a;border-color:#f59e0b"></span>최적경로</span>`;
  lg+=`<span class="legend-item"><span class="lg-dot" style="background:#f0f0f0;border-color:#ccc"></span>미방문</span>`;
  lg+='<span style="margin-left:8px">|</span>';
  lg+=`<span class="legend-item"><span class="lg-line" style="background:#3b82f6"></span>하루권</span>`;
  lg+=`<span class="legend-item"><span class="lg-line" style="background:#22c55e"></span>한달권</span>`;
  lg+=`<span class="legend-item"><span class="lg-line" style="background:#f97316;border-top:2px dashed #f97316;height:0"></span>세달권</span>`;
  document.getElementById('lgd').innerHTML=lg;
}

// ===== Tree Building =====
let allNodes=[], root=null;
function buildTree(){
  let nid=0; allNodes=[];
  function build(month, costSum, parent, tkIdx, tkCost){
    const node={id:nid++, month, costSum, parent, tkIdx, tkCost,
      children:[], depth:parent?parent.depth+1:0,
      state:'unvisited', dfsOrder:-1, minAtVisit:-1,
      onOptimal:false, x:0, y:0};
    allNodes.push(node);
    if(month<=M){
      node.children.push(build(month+1, costSum+PLAN[month]*COST[0], node, 0, PLAN[month]*COST[0]));
      node.children.push(build(month+1, costSum+COST[1], node, 1, COST[1]));
      node.children.push(build(month+3, costSum+COST[2], node, 2, COST[2]));
    }
    return node;
  }
  root=build(1,0,null,-1,0);
}

// ===== DFS Simulation =====
let dfsSeq=[], minHist=[], finalMin=0, bestLeaf=null;
function simulateDFS(){
  let min=COST[3], order=0;
  dfsSeq=[]; minHist=[{order:-1,min:COST[3],label:'초기값(1년권)'}];
  allNodes.forEach(n=>{n.state='unvisited';n.dfsOrder=-1;n.onOptimal=false;});

  function dfs(node){
    node.dfsOrder=order++;
    node.minAtVisit=min;
    dfsSeq.push(node);
    if(min<=node.costSum){
      node.state='pruned';
      return;
    }
    if(node.month>M){
      min=node.costSum;
      node.state='completed';
      minHist.push({order:node.dfsOrder,min,label:`${node.costSum}원`});
      return;
    }
    node.state='internal';
    for(const ch of node.children) dfs(ch);
  }
  dfs(root);
  finalMin=min;

  bestLeaf=null;
  for(const n of dfsSeq){
    if(n.state==='completed'&&(!bestLeaf||n.costSum<bestLeaf.costSum)) bestLeaf=n;
  }
  if(bestLeaf){let n=bestLeaf;while(n){n.onOptimal=true;n=n.parent;}}
}

// ===== Layout =====
let svgW=0, svgH=0;
const R=15, LEAF_SP=50, LVL_H=90;
function layoutTree(){
  let li=0;
  function pos(n){
    if(!n.children.length){n.x=li*LEAF_SP+40;li++;}
    else{n.children.forEach(pos);n.x=(n.children[0].x+n.children[n.children.length-1].x)/2;}
    n.y=n.depth*LVL_H+35;
  }
  pos(root);
  const maxX=allNodes.reduce((m,n)=>Math.max(m,n.x),0);
  const maxD=allNodes.reduce((m,n)=>Math.max(m,n.depth),0);
  svgW=maxX+60; svgH=(maxD+1)*LVL_H+60;
}

// ===== SVG Rendering =====
function renderSVG(){
  let s='';
  function drawEdges(n){
    n.children.forEach(c=>{
      s+=`<line id="E${c.id}" x1="${n.x}" y1="${n.y}" x2="${c.x}" y2="${c.y}" class="te-unvisited"/>`;
      const mx=(n.x+c.x)/2, my=(n.y+c.y)/2;
      let offsetX;
      if(c.tkIdx===0) offsetX=-20;
      else if(c.tkIdx===1) offsetX=-10;
      else offsetX=10;
      s+=`<text id="EL${c.id}" x="${mx+offsetX}" y="${my+2}" class="edge-cost" style="opacity:.25">${c.tkCost}</text>`;
      drawEdges(c);
    });
  }
  drawEdges(root);
  function drawNodes(n){
    n.children.forEach(drawNodes);
    s+=`<circle id="N${n.id}" cx="${n.x}" cy="${n.y}" r="${R}" class="tree-node tn-unvisited"/>`;
    const lbl=n.month>M?'>'+M:n.month;
    s+=`<text id="NL${n.id}" x="${n.x}" y="${n.y}" class="node-lbl">${lbl}</text>`;
    s+=`<text id="CL${n.id}" x="${n.x}" y="${n.y+R+14}" class="cost-lbl">${n.costSum}</text>`;
  }
  drawNodes(root);
  document.getElementById('tc').innerHTML=`<svg id="treeSvg" width="${svgW}" height="${svgH}">${s}</svg>`;

  const visited=dfsSeq.length, pruned=dfsSeq.filter(n=>n.state==='pruned').length;
  const unvisited=allNodes.length-visited;
  document.getElementById('treeStat').textContent=
    ` (${allNodes.length}개 노드 · 방문${visited} · 가지치기${pruned} · 미방문${unvisited})`;

  const svg=document.getElementById('treeSvg');
  svg.addEventListener('mouseover',onNodeOver);
  svg.addEventListener('mouseout',onNodeOut);
}

// ===== Coloring =====
function stateClass(st,onOpt){
  if(onOpt&&(st==='completed'||st==='internal')) return 'tn-optimal';
  if(st==='internal') return 'tn-internal';
  if(st==='completed') return 'tn-completed';
  if(st==='pruned') return 'tn-pruned';
  return 'tn-unvisited';
}
function edgeStateClass(child){
  const tk='te-'+TK_KEY[child.tkIdx];
  if(child.state==='unvisited') return 'te-unvisited te-dim';
  let cls=tk;
  if(child.state==='pruned') cls+=' te-pruned-state';
  if(child.onOptimal) cls+=' te-optimal';
  return cls;
}

function applyFinal(){
  allNodes.forEach(n=>{
    const c=document.getElementById('N'+n.id);
    if(c) c.className.baseVal='tree-node '+stateClass(n.state,n.onOptimal);
    const cl=document.getElementById('CL'+n.id);
    if(cl){
      let cc='cost-lbl';
      if(n.onOptimal&&n.state==='completed') cc+=' cl-optimal';
      else if(n.state==='completed') cc+=' cl-completed';
      cl.className.baseVal=cc;
    }
    if(n.parent){
      const e=document.getElementById('E'+n.id);
      if(e) e.className.baseVal=edgeStateClass(n);
      const el=document.getElementById('EL'+n.id);
      if(el) el.style.opacity=(n.state==='unvisited')?'.15':'0.6';
    }
  });
  // Min displays
  document.getElementById('minVal').textContent=finalMin;
  document.getElementById('minVal2').textContent=finalMin;
  document.getElementById('minHist2').textContent='('+minHist.map(h=>h.min).join(' → ')+')';
  // Summary
  const optPath=getPath(bestLeaf);
  const optStr=optPath.map((n,i)=>{
    if(i===0) return n.month+'월';
    return TK_NAME[n.tkIdx]+'(+'+n.tkCost+') → '+(n.month>M?'완료':n.month+'월');
  }).join(' ');
  document.getElementById('summaryDisp').innerHTML=
    '경로: '+optStr+' &nbsp;|&nbsp; min 갱신: '+minHist.map(h=>h.min).join(' → ');
}

// ===== Hover =====
function onNodeOver(e){
  const t=e.target;
  if(!t.classList||!t.classList.contains('tree-node')) return;
  highlightPath(allNodes[parseInt(t.id.substring(1))]);
}
function onNodeOut(e){
  const t=e.target;
  if(!t.classList||!t.classList.contains('tree-node')) return;
  clearHighlight();
}

function getPath(node){
  const path=[];
  let n=node;
  while(n){path.unshift(n);n=n.parent;}
  return path;
}

function highlightPath(node){
  allNodes.forEach(n=>{
    const c=document.getElementById('N'+n.id);
    if(c) c.style.opacity='.35';
    if(n.parent){
      const e=document.getElementById('E'+n.id);
      if(e) e.style.opacity='.1';
      const el=document.getElementById('EL'+n.id);
      if(el) el.style.opacity='.1';
    }
  });
  const path=getPath(node);
  path.forEach(n=>{
    const c=document.getElementById('N'+n.id);
    if(c) c.style.opacity='1';
    if(n.parent){
      const e=document.getElementById('E'+n.id);
      if(e){e.style.opacity='1';e.classList.add('te-highlight');}
      const el=document.getElementById('EL'+n.id);
      if(el) el.style.opacity='1';
    }
  });
}

function clearHighlight(){
  allNodes.forEach(n=>{
    const c=document.getElementById('N'+n.id);
    if(c) c.style.opacity='';
    if(n.parent){
      const e=document.getElementById('E'+n.id);
      if(e){e.style.opacity='';e.classList.remove('te-highlight');}
      const el=document.getElementById('EL'+n.id);
      if(el) el.style.opacity='';
    }
  });
}

// ===== Code Panel =====
function toggleCode(){
  const p=document.getElementById('codePanel');
  p.classList.toggle('collapsed');
  if(p.classList.contains('collapsed')){p.style.width='';p.style.minWidth='';}
}

// ===== Tree Expand =====
function toggleTreeExpand(){
  document.getElementById('vizPanel').classList.toggle('tree-expanded');
}

// ===== Resizer =====
(function(){
  const resizer=document.getElementById('resizer');
  const cp=document.getElementById('codePanel');
  let sx,sw;
  resizer.addEventListener('mousedown',function(e){
    if(cp.classList.contains('collapsed'))return;
    sx=e.clientX;sw=cp.offsetWidth;
    document.body.classList.add('resizing');resizer.classList.add('dragging');
    document.addEventListener('mousemove',onMM);document.addEventListener('mouseup',onMU);
  });
  function onMM(e){const nw=Math.max(200,Math.min(sw+(e.clientX-sx),window.innerWidth-300));cp.style.width=nw+'px';cp.style.minWidth=nw+'px';}
  function onMU(){document.body.classList.remove('resizing');resizer.classList.remove('dragging');document.removeEventListener('mousemove',onMM);document.removeEventListener('mouseup',onMU);}
})();

// ===== Keyboard =====
document.addEventListener('keydown',e=>{
  if(e.target.tagName==='INPUT')return;
  if(e.key==='t'||e.key==='T')toggleTreeExpand();
});

// ===== Init =====
initCode();
initPlan();
buildTree();
simulateDFS();
layoutTree();
renderSVG();
applyFinal();
</script>
</body>
</html>
