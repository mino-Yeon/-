<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Next Permutation - 4단계 분석</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Malgun Gothic','Apple SD Gothic Neo',sans-serif; background:#f0f2f5; color:#333; height:100vh; display:flex; flex-direction:column; }
.header { background:#2c3e50; color:#fff; padding:12px 24px; display:flex; align-items:center; gap:16px; }
.header h1 { font-size:18px; } .header .sub { font-size:13px; color:#94a3b8; }
.controls { background:#34495e; padding:10px 24px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.controls button { background:#3498db; color:#fff; border:none; padding:6px 14px; border-radius:4px; cursor:pointer; font-size:13px; font-family:inherit; }
.controls button:hover { background:#2980b9; }
.controls button.playing { background:#e74c3c; }
.sep { width:1px; height:24px; background:#4a6278; margin:0 4px; }
.controls label { color:#cbd5e1; font-size:13px; }
.controls input[type=range] { width:80px; vertical-align:middle; }
.step-info { color:#94a3b8; font-size:13px; margin-left:auto; }
.main { display:flex; flex:1; overflow:hidden; }
.code-panel { width:38%; min-width:300px; background:#1e1e1e; display:flex; flex-direction:column; transition:width .3s,min-width .3s; }
.code-panel.collapsed { width:40px; min-width:40px; }
.code-panel.collapsed .code-body { display:none; }
.code-panel.collapsed .panel-hd span { display:none; }
.panel-hd { background:#2d2d2d; color:#94a3b8; padding:6px 12px; font-size:12px; font-weight:600; border-bottom:1px solid #3d3d3d; user-select:none; display:flex; align-items:center; gap:8px; }
.fold-btn { cursor:pointer; padding:2px 4px; font-size:10px; transition:transform .3s; }
.code-panel.collapsed .fold-btn { transform:rotate(180deg); }
.ct { padding:3px 12px; border-radius:4px; cursor:pointer; font-size:12px; color:#94a3b8; transition:background .15s,color .15s; }
.ct:hover { background:#3d3d3d; color:#d4d4d4; }
.ct.active { background:#264f78; color:#fff; }
.resizer { width:6px; background:#34495e; cursor:col-resize; transition:background .15s; flex-shrink:0; }
.resizer:hover,.resizer.dragging { background:#3498db; }
body.resizing { cursor:col-resize; user-select:none; }
body.resizing * { pointer-events:none; }
body.resizing .resizer { pointer-events:auto; }
.code-panel.collapsed+.resizer { display:none; }
.code-body { flex:1; overflow-y:auto; padding:8px 0; }
.cl { display:flex; padding:1px 0; font-family:'Consolas','D2Coding',monospace; font-size:14px; line-height:1.6; transition:background .15s; }
.cl.active { background:#264f78; }
.cl.skip-line { background:#4a2020; }
.cl.active .ln { color:#fff; }
.cl.skip-line .ln { color:#f87171; }
.ln { width:36px; text-align:right; padding-right:10px; color:#555; user-select:none; flex-shrink:0; }
.lc { color:#d4d4d4; white-space:pre; }
.kw { color:#569cd6; } .tp { color:#4ec9b0; } .nm { color:#b5cea8; } .st { color:#ce9178; } .cm { color:#6a9955; }
.viz-panel { flex:1; display:flex; flex-direction:column; overflow:hidden; }
/* 예제 바 */
.ex-bar { background:#1e293b; color:#e2e8f0; padding:10px 16px; font-size:14px; font-weight:600; border-bottom:2px solid #334155; }
.ex-bar .ex-num { color:#60a5fa; margin-right:8px; }
.ex-bar .ex-arr { color:#fbbf24; font-family:'Consolas','D2Coding',monospace; }
/* 4단계 스테퍼 */
.stepper { display:flex; gap:6px; padding:10px 16px; background:#f8fafc; border-bottom:1px solid #ddd; }
.step-card { flex:1; padding:10px 6px; border-radius:8px; text-align:center; background:#f1f5f9; color:#94a3b8; border:2px solid #e2e8f0; transition:all .3s; font-size:11px; line-height:1.4; }
.step-card .sn { font-size:20px; font-weight:800; display:block; margin-bottom:2px; }
.step-card.s-active { background:#dbeafe; color:#1d4ed8; border-color:#3b82f6; font-weight:700; transform:scale(1.03); box-shadow:0 2px 8px rgba(59,130,246,.3); }
.step-card.s-done { background:#dcfce7; color:#15803d; border-color:#22c55e; font-weight:600; }
/* 변수/배열/설명 섹션 */
.vs { border-bottom:1px solid #ddd; }
.vs .sh { background:#e8ecf0; padding:6px 16px; font-size:12px; font-weight:600; color:#64748b; }
.vs .sb { padding:12px 16px; background:#fff; }
.var-c { display:flex; gap:12px; flex-wrap:wrap; }
.vb { display:inline-flex; align-items:center; padding:6px 14px; border-radius:6px; font-size:15px; font-weight:600; font-family:'Consolas','D2Coding',monospace; }
.vi { background:#dbeafe; color:#1d4ed8; } .vj { background:#fce7f3; color:#be185d; } .vleft { background:#e0f2fe; color:#0369a1; } .vright { background:#d1fae5; color:#065f46; }
.vn { background:#e2e8f0; color:#475569; }
/* 배열 시각화 */
.arr-viz { display:flex; flex-direction:column; align-items:flex-start; padding:4px 0; min-height:100px; }
.arr-row { display:flex; gap:6px; }
.ab { width:48px; text-align:center; }
.ab .box { width:48px; height:44px; display:flex; align-items:center; justify-content:center; border:2px solid #94a3b8; border-radius:8px; font-size:18px; font-weight:700; font-family:'Consolas','D2Coding',monospace; background:#f8fafc; transition:all .25s; }
.ab .idx { font-size:10px; color:#94a3b8; margin-top:2px; }
.ab.comparing .box { border-color:#3b82f6; background:#dbeafe; color:#1d4ed8; }
.ab.pos-im1 .box { border-color:#f59e0b; background:#fef3c7; color:#b45309; box-shadow:0 0 8px rgba(245,158,11,.4); }
.ab.pos-j .box { border-color:#ec4899; background:#fce7f3; color:#be185d; box-shadow:0 0 8px rgba(236,72,153,.3); }
.ab.swapping .box { transform:scale(1.15); border-color:#8b5cf6; background:#ede9fe; color:#6d28d9; box-shadow:0 0 12px rgba(139,92,246,.5); }
.ab.desc-suffix .box { border-color:#f87171; background:#fee2e2; color:#dc2626; }
.ab.reversed .box { border-color:#22c55e; background:#dcfce7; color:#15803d; }
.ptr-row { display:flex; gap:6px; margin-top:4px; height:22px; }
.ptr-cell { width:48px; text-align:center; font-size:11px; font-weight:700; font-family:'Consolas','D2Coding',monospace; line-height:22px; }
.ptr-im1 { color:#b45309; } .ptr-i { color:#1d4ed8; } .ptr-j { color:#be185d; } .ptr-left { color:#0369a1; } .ptr-right { color:#065f46; } .ptr-dim { color:#b0b8c4; }
/* 설명 */
.desc { font-size:15px; line-height:1.7; min-height:52px; display:flex; align-items:center; }
.ac-scan { color:#3b82f6; font-weight:700; } .ac-found { color:#7c3aed; font-weight:700; }
.ac-swap { color:#8b5cf6; font-weight:700; } .ac-rev { color:#059669; font-weight:700; }
.ac-done { color:#ef4444; font-weight:700; } .ac-ret { color:#6366f1; font-weight:700; }
.ac-init { color:#64748b; font-weight:600; } .ac-chk { color:#d97706; font-weight:600; }
.kbd-help { color:#64748b; font-size:11px; margin-left:12px; }
</style>
</head>
<body>
<div class="header">
  <h1>Next Permutation - 4단계 분석</h1>
  <span class="sub">np() 함수의 4단계를 3가지 예제로 분석</span>
</div>
<div class="controls">
  <button onclick="reset()">⏮ 처음</button>
  <button onclick="prev()">◀ 이전</button>
  <button id="playBtn" onclick="togglePlay()">▶ 재생</button>
  <button onclick="next()">다음 ▶</button>
  <div class="sep"></div>
  <button onclick="skipOut()">⏩ 다음 결과</button>
  <div class="sep"></div>
  <label>속도: <input type="range" id="spd" min="1" max="10" value="5" oninput="spVal=+this.value"></label>
  <span class="step-info" id="si">준비</span>
  <span class="kbd-help">키보드: ←→ 이전/다음 · Space 재생 · S 다음결과 · R 처음</span>
</div>
<div class="main">
  <div class="code-panel" id="codePanel">
    <div class="panel-hd"><span class="fold-btn" onclick="toggleCode()">◀</span><span class="ct active" id="ct0" onclick="switchCode(0)">while</span><span class="ct" id="ct1" onclick="switchCode(1)">for</span></div>
    <div class="code-body" id="cb"></div>
  </div>
  <div class="resizer" id="resizer"></div>
  <div class="viz-panel">
    <div class="ex-bar" id="exBar"><span class="ex-num">예제 1/3</span> <span class="ex-arr">[1, 2, 3, 4, 5, 6, 7]</span></div>
    <div class="stepper" id="stepper">
      <div class="step-card" id="sc1"><span class="sn">①</span>오름차순인<br>숫자 찾기</div>
      <div class="step-card" id="sc2"><span class="sn">②</span>해당 숫자보다<br>큰 숫자 찾기</div>
      <div class="step-card" id="sc3"><span class="sn">③</span>스왑</div>
      <div class="step-card" id="sc4"><span class="sn">④</span>뒤의 요소들<br>뒤집기</div>
    </div>
    <div class="vs"><div class="sh">변수 상태</div><div class="sb"><div class="var-c" id="vc"></div></div></div>
    <div class="vs"><div class="sh">배열 상태 (arr[7])</div><div class="sb"><div class="arr-viz" id="av"></div></div></div>
    <div class="vs" style="flex:1"><div class="sh">실행 설명</div><div class="sb"><div class="desc" id="dc">▶ 재생 또는 다음 버튼으로 시작하세요.</div></div></div>
  </div>
</div>
<script>
const SRC=[
'static boolean np(int[] arr) {',
'    int N = arr.length;',
'',
'    //1. 뒤에서부터 오름차순인 숫자찾기',
'    int i=N-1;',
'    while(i > 0 && arr[i-1] >= arr[i]) i--;',
'',
'    if(i == 0) return false;',
'',
'    //2. 해당 숫자보다 큰 숫자를 뒤에서부터 찾기',
'    int j=N-1;',
'    while(arr[i-1] >= arr[j]) j--;',
'',
'    //3. 두 요소 스왑',
'    swap(arr, i-1, j);',
'',
'    //4. 뒤의 요소들 뒤집기',
'    int left=i, right=N-1;',
'    while(left < right) swap(arr, left++, right--);',
'',
'    return true;',
'}'
];
const SRC_FOR=[
'static boolean np(int[] arr) {',
'    int N = arr.length;',
'',
'    //1. 뒤에서부터 오름차순인 숫자 찾기',
'    int i=N-1;',
'    for(; i>0; i--) if(arr[i-1] < arr[i]) break;',
'',
'    if(i==0) return false;',
'',
'    //2. 해당 숫자보다 큰 숫자를 뒤에서부터 찾기',
'    int j=N-1;',
'    for(; ; j--) if(arr[i-1] < arr[j]) break;',
'',
'    //3. 두 요소 스왑',
'    swap(arr, i-1, j);',
'',
'    //4. 뒤의 요소들 뒤집기',
'    int left=i, right=N-1;',
'    while(left < right) swap(arr, left++, right--);',
'',
'    return true;',
'}'
];
const SRCS=[SRC,SRC_FOR];
let curSrc=0;
function hl(t){t=t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');let cm='';t=t.replace(/(\/\/.*)$/gm,function(m){cm=m;return '\x00CM';});let ss=[];t=t.replace(/"([^"]*)"/g,function(m){ss.push(m);return '\x00S'+(ss.length-1);});t=t.replace(/\b(package|import|public|private|class|static|void|new|for|int|boolean|if|return|while|do|true|false|continue|break)\b/g,'<span class="kw">$1</span>');t=t.replace(/\b(String|Arrays|Integer|System|Scanner)\b/g,'<span class="tp">$1</span>');t=t.replace(/\b(\d+)\b/g,'<span class="nm">$1</span>');ss.forEach((s,i)=>{t=t.replace('\x00S'+i,'<span class="st">'+s+'</span>');});if(cm)t=t.replace('\x00CM','<span class="cm">'+cm+'</span>');return t;}
function initCode(){document.getElementById('cb').innerHTML=SRCS[curSrc].map((l,i)=>`<div class="cl" id="L${i+1}"><span class="ln">${i+1}</span><span class="lc">${hl(l)}</span></div>`).join('');}
function switchCode(idx){curSrc=idx;document.getElementById('ct0').className='ct'+(idx===0?' active':'');document.getElementById('ct1').className='ct'+(idx===1?' active':'');initCode();render();}

const EXAMPLES=[
  {arr:[1,2,3,4,5,6,7], label:'가장 작은 순열 (오름차순)'},
  {arr:[1,5,4,7,6,3,2], label:'일반적인 경우'},
  {arr:[7,6,5,4,3,2,1], label:'가장 큰 순열 (내림차순)'}
];
const N=7;

function genSteps(){
  const S=[];
  for(let e=0;e<EXAMPLES.length;e++){
    let arr=[...EXAMPLES[e].arr];
    const label='['+arr.join(', ')+']';

    // 예제 시작
    S.push({l:0,v:{i:'-',j:'-',left:'-',right:'-',N:'-'},r:[...arr],a:'intro',phase:0,ex:e,
      d:'<b>예제 '+(e+1)+'</b>: <b>'+label+'</b> — '+EXAMPLES[e].label});

    // int N = arr.length
    S.push({l:2,v:{i:'-',j:'-',left:'-',right:'-',N},r:[...arr],a:'init',phase:0,ex:e,
      d:'<span class="ac-init">N</span> = arr.length → <b>'+N+'</b>'});

    // ======= 1단계 =======
    let i=N-1;
    S.push({l:5,v:{i,j:'-',left:'-',right:'-',N},r:[...arr],a:'init',phase:1,ex:e,
      d:'<span class="ac-scan">1단계 시작</span>: i = N-1 → <b>'+i+'</b> (뒤에서부터 탐색)',
      hi:{i:i,labels:{im1:i-1}}});

    while(i>0 && arr[i-1]>=arr[i]){
      S.push({l:6,v:{i,j:'-',left:'-',right:'-',N},r:[...arr],a:'scan',phase:1,ex:e,
        d:'arr['+(i-1)+']=<b>'+arr[i-1]+'</b> &gt;= arr['+i+']=<b>'+arr[i]+'</b> → 내림차순, i-- → <b>'+(i-1)+'</b>',
        hi:{cmp:[i-1,i],desc:[i,N-1],labels:{im1:i-1,i:i}}});
      i--;
    }

    if(i>0){
      S.push({l:6,v:{i,j:'-',left:'-',right:'-',N},r:[...arr],a:'found',phase:1,ex:e,
        d:'arr['+(i-1)+']=<b>'+arr[i-1]+'</b> &lt; arr['+i+']=<b>'+arr[i]+'</b> → <span class="ac-found">i-1 = '+(i-1)+' (값: '+arr[i-1]+') 찾음!</span>',
        hi:{im1:i-1,desc:[i,N-1],idim:i}});
    } else {
      S.push({l:6,v:{i,j:'-',left:'-',right:'-',N},r:[...arr],a:'found',phase:1,ex:e,
        d:'i = 0 → <span class="ac-done">배열 전체가 내림차순 (마지막 순열)</span>',
        hi:{desc:[0,N-1]}});
    }

    if(i===0){
      S.push({l:8,v:{i,j:'-',left:'-',right:'-',N},r:[...arr],a:'done',phase:1,ex:e,
        d:'<span class="ac-done">return false</span> — 더 이상 다음 순열이 없습니다!',
        hi:{desc:[0,N-1]}});
      continue;
    }

    S.push({l:8,v:{i,j:'-',left:'-',right:'-',N},r:[...arr],a:'check',phase:1,ex:e,
      d:'i = '+i+' ≠ 0 → 다음 순열 존재!',
      hi:{im1:i-1,desc:[i,N-1],idim:i}});

    // ======= 2단계 =======
    let j=N-1;
    S.push({l:11,v:{i,j,left:'-',right:'-',N},r:[...arr],a:'init',phase:2,ex:e,
      d:'<span class="ac-scan">2단계 시작</span>: j = N-1 → <b>'+j+'</b> (뒤에서부터 탐색)',
      hi:{im1:i-1,j,desc:[i,N-1]}});

    while(arr[i-1]>=arr[j]){
      S.push({l:12,v:{i,j,left:'-',right:'-',N},r:[...arr],a:'scan',phase:2,ex:e,
        d:'arr['+(i-1)+']=<b>'+arr[i-1]+'</b> &gt;= arr['+j+']=<b>'+arr[j]+'</b> → j-- → <b>'+(j-1)+'</b>',
        hi:{im1:i-1,cmp:[i-1,j],desc:[i,N-1],labels:{j:j}}});
      j--;
    }

    S.push({l:12,v:{i,j,left:'-',right:'-',N},r:[...arr],a:'found',phase:2,ex:e,
      d:'arr['+(i-1)+']=<b>'+arr[i-1]+'</b> &lt; arr['+j+']=<b>'+arr[j]+'</b> → <span class="ac-found">j = '+j+' (값: '+arr[j]+') 찾음!</span>',
      hi:{im1:i-1,j,desc:[i,N-1]}});

    // ======= 3단계 =======
    S.push({l:15,v:{i,j,left:'-',right:'-',N},r:[...arr],a:'swap',phase:3,ex:e,
      d:'<span class="ac-swap">3단계</span>: arr['+(i-1)+']=<b>'+arr[i-1]+'</b> ↔ arr['+j+']=<b>'+arr[j]+'</b> 스왑',
      hi:{swap:[i-1,j]}});

    let tmp=arr[i-1]; arr[i-1]=arr[j]; arr[j]=tmp;

    S.push({l:15,v:{i,j,left:'-',right:'-',N},r:[...arr],a:'swap',phase:3,ex:e,
      d:'<span class="ac-swap">스왑 완료</span>: ['+arr.join(', ')+']',
      hi:{im1:i-1,j,desc:[i,N-1]}});

    // ======= 4단계 =======
    let left=i,right=N-1;
    S.push({l:18,v:{i,j,left,right,N},r:[...arr],a:'init',phase:4,ex:e,
      d:'<span class="ac-rev">4단계 시작</span>: left = i → <b>'+left+'</b>, right = N-1 → <b>'+right+'</b> (뒤집기)',
      hi:{rev:[i,N-1],left:left,right:right}});

    if(left<right){
      while(left<right){
        S.push({l:19,v:{i,j,left,right,N},r:[...arr],a:'reverse',phase:4,ex:e,
          d:'arr['+left+']=<b>'+arr[left]+'</b> ↔ arr['+right+']=<b>'+arr[right]+'</b> 스왑',
          hi:{swap:[left,right],rev:[i,N-1],left:left,right:right}});
        tmp=arr[left]; arr[left]=arr[right]; arr[right]=tmp;
        left++; right--;
        S.push({l:19,v:{i,j,left,right,N},r:[...arr],a:'reverse',phase:4,ex:e,
          d:'['+arr.join(', ')+']',
          hi:{rev:[i,N-1],left:left,right:right}});
      }
    } else {
      S.push({l:19,v:{i,j,left,right,N},r:[...arr],a:'reverse',phase:4,ex:e,
        d:'left('+left+') &gt;= right('+right+') → 뒤집을 구간 없음',
        hi:{left:left,right:right}});
    }

    // 결과
    S.push({l:21,v:{i,j,left,right,N},r:[...arr],a:'result',phase:5,ex:e,
      d:'<span class="ac-ret">return true</span> — 결과: <b>['+arr.join(', ')+']</b>'});
  }
  return S;
}

let steps=[],ci=-1,playing=false,timer=null,spVal=5;

function getBlockClass(idx,hi){
  if(!hi) return 'ab';
  if(hi.swap && (hi.swap[0]===idx||hi.swap[1]===idx)) return 'ab swapping';
  if(hi.im1===idx) return 'ab pos-im1';
  if(hi.j===idx) return 'ab pos-j';
  if(hi.cmp && (hi.cmp[0]===idx||hi.cmp[1]===idx)) return 'ab comparing';
  if(hi.rev && idx>=hi.rev[0] && idx<=hi.rev[1]) return 'ab reversed';
  if(hi.desc && idx>=hi.desc[0] && idx<=hi.desc[1]) return 'ab desc-suffix';
  return 'ab';
}

function renderArrViz(arr,hi){
  hi=hi||{};
  let h='<div class="arr-row">';
  for(let idx=0;idx<N;idx++){
    h+='<div class="'+getBlockClass(idx,hi)+'"><div class="box">'+arr[idx]+'</div><div class="idx">['+idx+']</div></div>';
  }
  h+='</div><div class="ptr-row">';
  const lb=hi.labels||{};
  for(let idx=0;idx<N;idx++){
    let ptrs=[];
    const hasIm1=hi.im1===idx||lb.im1===idx;
    const hasJ=hi.j===idx||lb.j===idx;
    if(hasIm1 && hasJ){ ptrs.push('<span class="ptr-im1">i-1</span>,<span class="ptr-j">j</span>'); }
    else {
      if(hasIm1) ptrs.push('<span class="ptr-im1">i-1</span>');
      if(hasJ) ptrs.push('<span class="ptr-j">j</span>');
    }
    if(hi.i===idx||lb.i===idx) ptrs.push('<span class="ptr-i">i</span>');
    if(hi.idim===idx) ptrs.push('<span class="ptr-dim">i</span>');
    if(hi.left===idx||lb.left===idx) ptrs.push('<span class="ptr-left">left</span>');
    if(hi.right===idx||lb.right===idx) ptrs.push('<span class="ptr-right">right</span>');
    if(hi.swap && !ptrs.length){
      if(hi.swap[0]===idx) ptrs.push('<span class="ptr-im1">↕</span>');
      if(hi.swap[1]===idx) ptrs.push('<span class="ptr-j">↕</span>');
    }
    h+='<div class="ptr-cell">'+(ptrs.length?ptrs.join(' '):'&nbsp;')+'</div>';
  }
  h+='</div>';
  return h;
}

function updateStepper(phase){
  for(let p=1;p<=4;p++){
    const sc=document.getElementById('sc'+p);
    sc.className='step-card';
    if(phase>=5||(phase>0&&p<phase)) sc.classList.add('s-done');
    else if(p===phase) sc.classList.add('s-active');
  }
}

function updateExBar(s){
  const ex=EXAMPLES[s.ex];
  const bar=document.getElementById('exBar');
  bar.innerHTML='<span class="ex-num">예제 '+(s.ex+1)+'/'+EXAMPLES.length+'</span> <span class="ex-arr">['+ex.arr.join(', ')+']</span> — '+ex.label;
}

function render(){
  document.querySelectorAll('.cl.active,.cl.skip-line').forEach(e=>{e.classList.remove('active');e.classList.remove('skip-line');});
  if(ci>=0){
    const s=steps[ci];
    if(s.l>0){
      const el=document.getElementById('L'+s.l);
      if(el){
        el.classList.add(s.a==='done'?'skip-line':'active');
        el.scrollIntoView({block:'nearest',behavior:'smooth'});
      }
    }
  }
  if(ci<0){
    updateStepper(0);
    document.getElementById('exBar').innerHTML='<span class="ex-num">준비</span> 3개의 예제로 Next Permutation 4단계를 학습합니다';
    document.getElementById('vc').innerHTML='<span class="vb vi">i = -</span><span class="vb vj">j = -</span><span class="vb vleft">left = -</span><span class="vb vright">right = -</span><span class="vb vn">N = -</span>';
    document.getElementById('av').innerHTML=renderArrViz(EXAMPLES[0].arr,{});
    document.getElementById('dc').innerHTML='▶ 재생 또는 다음 버튼으로 시작하세요.';
    document.getElementById('si').textContent=`0 / ${steps.length}`;
    return;
  }
  const s=steps[ci];
  updateStepper(s.phase);
  updateExBar(s);
  document.getElementById('vc').innerHTML=`<span class="vb vi">i = ${s.v.i}</span><span class="vb vj">j = ${s.v.j}</span><span class="vb vleft">left = ${s.v.left}</span><span class="vb vright">right = ${s.v.right}</span><span class="vb vn">N = ${s.v.N}</span>`;
  document.getElementById('av').innerHTML=renderArrViz(s.r,s.hi);
  document.getElementById('dc').innerHTML=s.d;
  document.getElementById('si').textContent=`${ci+1} / ${steps.length}`;
}

function reset(){stop();ci=-1;render();}
function prev(){stop();if(ci>-1){ci--;render();}}
function next(){if(ci<steps.length-1){ci++;render();}else stop();}
function togglePlay(){playing?stop():start();}
function start(){if(ci>=steps.length-1)ci=-1;playing=true;document.getElementById('playBtn').textContent='⏸ 정지';document.getElementById('playBtn').classList.add('playing');tick();}
function stop(){playing=false;clearTimeout(timer);timer=null;document.getElementById('playBtn').textContent='▶ 재생';document.getElementById('playBtn').classList.remove('playing');}
function tick(){if(!playing)return;const d=1100-spVal*100;timer=setTimeout(()=>{next();if(playing&&ci<steps.length-1)tick();else stop();},d);}
function skipOut(){stop();for(let i=ci+1;i<steps.length;i++){if(steps[i].a==='result'||steps[i].a==='done'){ci=i;render();return;}}ci=steps.length-1;render();}

document.addEventListener('keydown',e=>{
  if(e.key==='ArrowRight'||e.key===' '){e.preventDefault();next();}
  else if(e.key==='ArrowLeft'){e.preventDefault();prev();}
  else if(e.key==='Enter'){e.preventDefault();togglePlay();}
  else if(e.key==='r'||e.key==='R')reset();
  else if(e.key==='s'||e.key==='S')skipOut();
});

function toggleCode(){const p=document.getElementById('codePanel');p.classList.toggle('collapsed');if(p.classList.contains('collapsed')){p.style.width='';p.style.minWidth='';}}
(function(){const r=document.getElementById('resizer'),cp=document.getElementById('codePanel');let sx,sw;r.addEventListener('mousedown',function(e){if(cp.classList.contains('collapsed'))return;sx=e.clientX;sw=cp.offsetWidth;document.body.classList.add('resizing');r.classList.add('dragging');document.addEventListener('mousemove',mm);document.addEventListener('mouseup',mu);});function mm(e){const nw=Math.max(200,Math.min(sw+(e.clientX-sx),window.innerWidth-300));cp.style.width=nw+'px';cp.style.minWidth=nw+'px';}function mu(){document.body.classList.remove('resizing');r.classList.remove('dragging');document.removeEventListener('mousemove',mm);document.removeEventListener('mouseup',mu);}})();

initCode();steps=genSteps();render();
</script>
</body>
</html>
